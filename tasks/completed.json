[
  {
    "task_id": "task_1769898908977",
    "description": "Read the podcast_crew.py file and list the main agent roles",
    "context": "Focus on identifying the Agent definitions",
    "priority": "normal",
    "status": "completed",
    "created_at": "2026-01-31T17:35:08.977540",
    "assigned_to": "coding_agent",
    "started_at": "2026-01-31T17:35:08.977955",
    "completed_at": "2026-01-31T17:35:17.005308",
    "result": {
      "success": true,
      "result": "Based on the podcast_crew.py file, I can identify the following main agent roles:\n\n## Main Agent Roles:\n\n1. **Lead Research Scientist** - Produces a high-impact scientific paper supporting the topic\n2. **Scientific Auditor** - Critically evaluates research, identifies gaps, and synthesizes a final verdict\n3. **Adversarial Researcher** - Produces a scientific paper challenging the topic by debunking specific claims\n4. **Podcast Producer** - Translates audited papers into a balanced dialogue\n5. **Podcast Personality** - Polishes the script for natural verbal delivery\n\nThese five agents work together in a sequential process to conduct scientific research on the topic of \"scientific benefit of coffee intake to increase productivity during the day\", with each agent having a specific role in the research and podcast creation pipeline.",
      "iterations": 2,
      "tool_calls": [
        {
          "tool": "read_file",
          "arguments": {
            "file_path": "podcast_crew.py"
          },
          "result": "File: podcast_crew.py\n\nimport os\nimport platform\nimport re\nimport httpx\nimport time\nimport random\nimport sys\nfrom pathlib import Path\nfrom dotenv import load_dotenv\nfrom crewai import Agent, Task, Crew, LLM\nfrom crewai.tools import tool\nfrom gtts import gTTS\nfrom fpdf import FPDF\n\n# --- INITIALIZATION ---\nload_dotenv()\nscript_dir = Path(__file__).parent.absolute()\noutput_dir = script_dir / \"research_outputs\"\noutput_dir.mkdir(exist_ok=True)\n\ntopic_name = 'scientific benefit of coffee intake to increase productivity during the day'\n\n# --- MODEL DETECTION & CONFIG ---\ndef get_final_model_string():\n    env_model = os.getenv(\"MODEL_NAME\")\n    if env_model:\n        print(f\"Using model from .env: {env_model}\")\n        return f\"openai/{env_model}\"\n\n    base_url = os.getenv(\"LLM_BASE_URL\", \"http://localhost:8000/v1\")\n    print(f\"Connecting to DGX Brain at {base_url}...\")\n    \n    for i in range(10):\n        try:\n            response = httpx.get(f\"{base_url}/models\", timeout=5.0)\n            if response.status_code == 200:\n                data = response.json()\n                model_id = data['data'][0]['id']\n                print(f\"Brain online! Auto-detected: {model_id}\")\n                return f\"openai/{model_id}\"\n        except Exception:\n            if i % 5 == 0:\n                print(f\"Waiting for LLM server... ({i*5}s)\")\n            time.sleep(5)\n            \n    print(\"Error: Could not detect model. Check if your DGX container is running.\")\n    sys.exit(1)\n\nfinal_model_string = get_final_model_string()\n\ndgx_llm = LLM(\n    model=final_model_string,\n    base_url=os.getenv(\"LLM_BASE_URL\", \"http://localhost:8000/v1\"),\n    api_key=\"NA\",\n    timeout=600,\n    temperature=0.1,\n    stop=[\"<|im_end|>\", \"<|endoftext|>\", \"Observation:\", \"Thought:\"]\n)\n\n@tool(\"BraveSearch\")\ndef search_tool(search_query: str):\n    \"\"\"Search the web for real-time scientific data and peer-reviewed studies.\"\"\"\n    api_key = os.getenv(\"BRAVE_API_KEY\")\n    if not api_key:\n        return \"Brave API Key missing. Use internal knowledge.\"\n\n    url = \"https://api.search.brave.com/res/v1/web/search\"\n    headers = {\"Accept\": \"application/json\", \"X-Subscription-Token\": api_key}\n    params = {\"q\": search_query, \"count\": 5}\n\n    try:\n        response = httpx.get(url, headers=headers, params=params, timeout=15.0)\n        if response.status_code == 200:\n            results = response.json().get(\"web\", {}).get(\"results\", [])\n            return \"\\n\\n\".join([f\"Title: {r['title']}\\nURL: {r['url']}\\nDesc: {r['description']}\" for r in results]) or \"No results found.\"\n        return \"Search API error. Use internal knowledge.\"\n    except Exception as e:\n        return f\"Search failed: {e}\"\n\n# --- PDF GENERATOR UTILITY ---\nclass SciencePDF(FPDF):\n    def header(self):\n        self.set_font('Helvetica', 'B', 12)\n        self.cell(0, 10, 'DGX Spark Research Intelligence Report', 0, 1, 'C')\n        self.ln(5)\n\n    def footer(self):\n        self.set_y(-15)\n        self.set_font('Helvetica', 'I', 8)\n        self.cell(0, 10, f'Page {self.page_no()}', 0, 0, 'C')\n\ndef create_pdf(title, content, filename):\n    pdf = SciencePDF()\n    pdf.add_page()\n    pdf.set_font(\"Helvetica\", \"B\", 16)\n    pdf.cell(0, 10, title, 0, 1, 'L')\n    pdf.ln(5)\n    \n    # Clean up markdown for PDF\n    clean_content = re.sub(r'<think>.*?</think>', '', str(content), flags=re.DOTALL)\n    clean_content = clean_content.encode('latin-1', 'ignore').decode('latin-1')\n    \n    pdf.set_font(\"Helvetica\", size=11)\n    pdf.multi_cell(0, 10, clean_content)\n    \n    file_path = output_dir / filename\n    pdf.output(str(file_path))\n    print(f\"PDF Generated: {file_path}\")\n    return file_path\n\n# --- AGENTS ---\nresearcher = Agent(\n    role='Lead Research Scientist',\n    goal=f'Produce a high-impact scientific paper supporting {topic_name}',\n    backstory='Senior researcher specializing in neurobiology and metabolic efficiency.',\n    tools=[search_tool],\n    llm=dgx_llm,\n    verbose=True\n)\n\nauditor = Agent(\n    role='Scientific Auditor',\n    goal='Critically evaluate research, identify gaps, and synthesize a final verdict.',\n    backstory='Meticulous chief editor specializing in resolving scientific conflicts.',\n    llm=dgx_llm,\n    verbose=True\n)\n\ncounter_researcher = Agent(\n    role='Adversarial Researcher',\n    goal=f'Produce a scientific paper challenging {topic_name} by debunking specific claims.',\n    backstory='Skeptical meta-analyst who specializes in identifying methodology flaws.',\n    tools=[search_tool],\n    llm=dgx_llm,\n    verbose=True\n)\n\nscriptwriter = Agent(\n    role='Podcast Producer',\n    goal='Translate audited papers into a balanced dialogue.',\n    backstory='Award-winning science communicator.',\n    llm=dgx_llm,\n    verbose=True\n)\n\npersonality = Agent(\n    role='Podcast Personality',\n    goal='Polish the script for natural verbal delivery.',\n    backstory='Radio host expert in humanizing technical data.',\n    llm=dgx_llm,\n    verbose=True\n)\n\n# --- TASKS ---\nresearch_task = Task(\n    description=(\n        f\"Conduct an exhaustive deep dive into {topic_name}. \"\n        \"Draft a condensed scientific paper (Nature style). \"\n        \"Include: Abstract, Introduction, 3 Biochemical Mechanisms, Bibliography with URLs.\"\n    ),\n    expected_output=\"A formal, condensed scientific paper with citations supporting the benefits.\",\n    agent=researcher\n)\n\ngap_analysis_task = Task(\n    description=(\n        \"Review the Lead Scientist's Supporting Paper. Identify potential weaknesses \"\n        \"and suggest specific topics for the Adversarial Researcher to investigate.\"\n    ),\n    expected_output=\"A list of 3-5 specific scientific 'weak points'.\",\n    agent=auditor,\n    context=[research_task]\n)\n\nadversarial_task = Task(\n    description=(\n        f\"Based on the 'Supporting Paper' and 'Gap Analysis', draft an 'Anti-Thesis' paper. \"\n        \"Address and debunk the mechanisms proposed in the initial research. Include Bibliography with URLs.\"\n    ),\n    expected_output=\"A formal, condensed scientific paper challenging the findings.\",\n    agent=counter_researcher,\n    context=[research_task, gap_analysis_task]\n)\n\naudit_task = Task(\n    description=(\n        \"Review both the Supporting and Anti-Thesis papers. Validate sources. \"\n        \"Prepare a Final Meta-Audit Report weighing evidence from both sides.\"\n    ),\n    expected_output=\"A high-level synthesis report providing a definitive verdict.\",\n    agent=auditor,\n    context=[research_task, adversarial_task]\n)\n\nscript_task = Task(\n    description=\"Write a technical podcast script based on the meta-report (Dr. Data vs Dr. Doubt).\",\n    expected_output=\"A conversational but technical dialogue script.\",\n    agent=scriptwriter,\n    context=[audit_task]\n)\n\nnatural_language_task = Task(\n    description=\"Rewrite for verbal delivery. Ensure natural flow and remove meta-tags.\",\n    expected_output=\"A final dialogue-only script.\",\n    agent=personality,\n    context=[script_task]\n)\n\n# --- EXECUTION ---\ncrew = Crew(\n    agents=[researcher, auditor, counter_researcher, scriptwriter, personality],\n    tasks=[research_task, gap_analysis_task, adversarial_task, audit_task, script_task, natural_language_task],\n    verbose=True,\n    process='sequential'\n)\n\nprint(f\"\\n--- Initiating Scientific Research Pipeline on DGX Spark ---\\n\")\nresult = crew.kickoff()\n\n# --- PDF GENERATION STEP ---\nprint(\"\\n--- Generating Documentation PDFs ---\")\ntry:\n    # Use task_outputs to get specific results\n    create_pdf(\"Supporting Scientific Paper\", research_task.output.raw, \"supporting_paper.pdf\")\n    create_pdf(\"Adversarial Anti-Thesis Paper\", adversarial_task.output.raw, \"adversarial_paper.pdf\")\n    create_pdf(\"Final Meta-Audit Verdict\", audit_task.output.raw, \"final_audit_report.pdf\")\nexcept Exception as e:\n    print(f\"Warning: PDF generation failed, but research is complete: {e}\")\n\n# --- AUDIO GENERATION ---\ndef generate_audio(crew_output):\n    filename = output_dir / \"podcast_final_audio.mp3\"\n    clean_text = re.sub(r'<think>.*?</think>', '', str(crew_output), flags=re.DOTALL)\n    clean_text = re.sub(r'[*#_]', '', clean_text)\n    \n    print(f\"Synthesizing speech to {filename}...\")\n    try:\n        tts = gTTS(text=clean_text, lang='en')\n        tts.save(str(filename))\n        \n        if platform.system() == \"Darwin\": os.system(f\"open '{filename}'\")\n        elif platform.system() == \"Windows\": os.startfile(str(filename))\n        else: os.system(f\"xdg-open '{filename}' &\")\n    except Exception as e:\n        print(f\"Audio failed: {e}\")\n\ngenerate_audio(result)"
        }
      ]
    }
  }
]